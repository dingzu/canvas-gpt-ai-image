# 画布预览功能改进

## 🎯 改进背景

用户反馈希望"当前画布预览"能够只显示真实传出生成的图片内容，而不是整个画布的缩略图。

## ✅ 实现的改进

### 📸 智能预览内容

**改进前**:
- 显示整个画布的缩略图
- 无法预知实际发送给AI的内容
- 与实际传输数据不一致

**改进后**:
- 显示实际会发送给AI的图像区域
- 完全与生成时使用的截取逻辑一致
- 添加绿色边框标识实际传输范围

### 🔄 实时响应变化

预览会实时响应以下变化：

1. **选择范围切换**
   - "仅选中对象" ↔ "整个画布"
   - 即时更新预览内容

2. **画布对象选择**
   - 选择不同对象时自动更新
   - 多选、取消选择都会实时反映

3. **智能提示信息**
   - 动态显示当前预览模式
   - 解释绿色边框的含义

### 🎨 界面优化

#### 新的预览界面
```
┌─────────────────────────────┐
│    实际传输内容预览          │
├─────────────────────────────┤
│  ┌─────────────────────┐    │
│  │                     │    │
│  │   [预览图像内容]     │    │
│  │   带绿色边框        │    │
│  │                     │    │
│  └─────────────────────┘    │
│                             │
│ 💡 显示选中对象区域          │
│    绿色边框表示实际发送给AI   │
│    的图像范围               │
└─────────────────────────────┘
```

#### 提示信息
- **选择范围为"仅选中对象"**: "显示选中对象区域"
- **选择范围为"整个画布"**: "显示所有内容区域"
- **绿色边框**: 标识实际传输的图像边界

### 🔧 技术实现

#### 核心逻辑
```javascript
// 使用与实际生成相同的截取逻辑
const contentBounds = getCaptureArea()

// 精确绘制实际传输的内容
ctx.drawImage(
  canvasElement,
  contentBounds.left, contentBounds.top, 
  contentBounds.width, contentBounds.height,
  offsetX, offsetY, 
  scaledWidth, scaledHeight
)

// 添加边框提示
ctx.strokeStyle = '#4ECDC4'
ctx.lineWidth = 2
ctx.strokeRect(offsetX - 1, offsetY - 1, scaledWidth + 2, scaledHeight + 2)
```

#### 事件监听
- **范围变化**: `watch(captureMode, updatePreview)`
- **对象选择**: `canvas.on('selection:*', updatePreview)`
- **内存管理**: `onUnmounted` 清理事件监听器

### 🎯 用户价值

#### 对普通用户
- 📋 **所见即所得**: 预览内容与实际发送完全一致
- 🎯 **精确控制**: 明确知道AI会处理哪些内容
- 👀 **直观反馈**: 实时看到选择范围的影响

#### 对开发者
- 🔍 **调试友好**: 便于验证截取逻辑是否正确
- ⚡ **性能优化**: 可以预估数据传输量
- 🧪 **测试便利**: 快速验证不同选择的效果

### 📊 功能对比

| 功能特性 | 改进前 | 改进后 |
|---------|--------|--------|
| 预览内容 | 整个画布缩略图 | 实际传输区域 ✅ |
| 实时更新 | 静态预览 | 动态响应变化 ✅ |
| 范围提示 | 无 | 智能提示信息 ✅ |
| 边界标识 | 无 | 绿色边框标识 ✅ |
| 数据一致性 | 不一致 | 完全一致 ✅ |

### 🚀 使用体验

#### 操作流程
1. **打开AI生成对话框** → 看到实际传输内容预览
2. **选择不同对象** → 预览实时更新显示选中区域
3. **切换选择范围** → 预览在"选中对象"和"全部内容"间切换
4. **查看提示信息** → 了解当前预览模式和边框含义
5. **开始生成** → 确保传输内容符合预期

#### 示例场景
- **精确生成**: 只想生成选中的图表 → 选择"仅选中对象"，预览显示图表区域
- **整体生成**: 想要包含所有元素 → 选择"整个画布"，预览显示全部内容
- **快速调整**: 在两种模式间切换，实时看到差异

### 💡 最佳实践

1. **生成前确认**: 通过预览确认传输内容符合预期
2. **合理选择范围**: 根据需求选择合适的截取范围
3. **注意边框提示**: 绿色边框内的内容就是AI会处理的部分
4. **多尝试切换**: 对比不同选择范围的效果

---

**总结**: 此次改进让预览功能真正做到了"所见即所得"，用户可以准确预知AI将处理的内容，大大提升了使用体验和生成效果的可预测性。 ✨
